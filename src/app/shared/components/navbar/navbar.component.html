<nav role="navigation" aria-label="main navigation" class="main-menu">
  <div class="navbar-start">
    <ng-container *ngFor="let button of filteredButtons">
      <a [routerLink]="button.link" class="border rounded-lg px-2">
        {{ button.label }}
        <fa-icon [icon]="button.icon" class="navbar-icon"></fa-icon>
      </a>
    </ng-container>
  </div>

  <div class="navbar-end gap-3">

    <div *ngIf="isLoading" class="text-gray-500">Cargando...</div>

    <div *ngIf="!isLoading && user" class="flex items-center gap-3">
      <div class="flex flex-col justify-center items-center text-sm text-slate-400">
        <p>{{ user.username }}</p>
        <p>{{ user.role }}</p>
      </div>
      <a class="w-8 h-8 overflow-hidden rounded-full" (click)="navigateToPanel()">
        <img [src]="user.profile_picture === 'not_found' 
        ? 'https://ui-avatars.com/api/?name=' + user.username + '&background=f77800&color=fff' 
        : user.profile_picture" [alt]="user.username + ' profile picture'" class="w-full h-full object-cover">
      </a>
      <a>
        <fa-icon [icon]="faBell" class="navbar-icon border rounded-lg px-4 py-1"></fa-icon>
      </a>
      <div class="relative">
        <a class="border px-3 py-1 rounded-lg cursor-pointer" (click)="toggleDropdown()">
          Settings
          <fa-icon [icon]="faAngleDown" class="navbar-icon"></fa-icon>
        </a>
        <div *ngIf="isDropdownOpen" class="absolute right-0 mt-2 w-48 bg-white border rounded-lg shadow-lg z-50">
          <ul>
            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer" (click)="navigateToPanel()">Panel</li>
            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer" (click)="navigateToProfile()">Profile</li>
            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer" routerLink="/panel/notifications/">Notifications</li>
            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer" (click)="logout()">Logout</li>
          </ul>
        </div>
      </div>
    </div>


    <div *ngIf="!isLoading && !user" class="flex gap-5">
      <a routerLink="/register" class="border rounded-lg px-4 py-1">Sign Up</a>
      <a routerLink="/login" class="rounded-lg px-4 py-1 bg-orange-500 text-white">Sign In</a>
    </div>
  </div>
</nav>


<nav class="mobile-menu">
  <button class="hamburger-btn" (click)="toggleMobileMenu()">
    <span class="hamburger-bar"></span>
    <span class="hamburger-bar"></span>
    <span class="hamburger-bar"></span>
  </button>

  <div *ngIf="isMobileMenuOpen" class="mobile-menu-items">
    <ng-container *ngFor="let button of filteredButtons">
      <a [routerLink]="button.link" class="mobile-menu-item rounded-lg">
        {{ button.label }}
        <fa-icon [icon]="button.icon" class="navbar-icon"></fa-icon>
      </a>
    </ng-container>


    <div *ngIf="!isLoading && user" class="mobile-user-menu">
      <div class="flex flex-col justify-center items-center text-sm text-slate-400">
        <p>{{ user.username }}</p>
        <p>{{ user.role }}</p>
      </div>
      <a class="w-8 h-8 overflow-hidden rounded-full" (click)="navigateToPanel()">
        <img [src]="'https://ui-avatars.com/api/?name=' + user.username + '&background=f77800&color=fff'"
          alt="Profile Picture" class="w-full h-full object-cover">
      </a>
      <a>
        <fa-icon [icon]="faBell" class="navbar-icon border rounded-lg px-4 py-1"></fa-icon>
      </a>
      <div class="dropdown relative flex flex-nowrap">
        <a class="border rounded-lg cursor-pointer" (click)="toggleDropdown()">
          Settings
          <fa-icon [icon]="faAngleDown" class="navbar-icon"></fa-icon>
        </a>
        <div *ngIf="isDropdownOpen" class="absolute bg-white border rounded-lg shadow-lg z-50">
          <ul>
            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer" routerLink="/settings/notifications">Notifications
            </li>
            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer" routerLink="/settings/profile">Profile</li>
            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer" (click)="logout()">Logout</li>
          </ul>
        </div>
      </div>
    </div>

    <div *ngIf="!isLoading && !user" class="navbar-end gap-3">
      <a routerLink="/register" class="border rounded-lg px-4 py-1">Sign Up</a>
      <a routerLink="/login" class="rounded-lg px-4 py-1 bg-orange-500 text-white">Sign In</a>
    </div>
  </div>
</nav>